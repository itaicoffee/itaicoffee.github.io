<!DOCTYPE html>
<head>
    <title>NPS</title>

    <!-- main.css -->
    <style>
        /*! normalize.css v3.0.2 | MIT License | git.io/normalize */

        html {
            font-family: sans-serif;
        }

        body {
            margin: 0
        }

        article,
        aside,
        details,
        figcaption,
        figure,
        footer,
        header,
        hgroup,
        main,
        menu,
        nav,
        section,
        summary {
            display: block
        }

        audio,
        canvas,
        progress,
        video {
            display: inline-block;
            vertical-align: baseline
        }

        audio:not([controls]) {
            display: none;
            height: 0
        }

        [hidden],
        template {
            display: none
        }

        a {
            background-color: transparent
        }

        a:active,
        a:hover {
            outline: 0
        }

        button,
        input,
        optgroup,
        select,
        textarea {
            color: inherit;
            font: inherit;
            margin: 0
        }

        button {
            overflow: visible
        }

        button,
        select {
            text-transform: none
        }

        button,
        html input[type="button"],
        input[type="reset"],
        input[type="submit"] {
            -webkit-appearance: button;
            cursor: pointer
        }

        button[disabled],
        html input[disabled] {
            cursor: default
        }

        button::-moz-focus-inner,
        input::-moz-focus-inner {
            border: 0;
            padding: 0
        }

        input {
            line-height: normal
        }

        input[type="checkbox"],
        input[type="radio"] {
            box-sizing: border-box;
            padding: 0
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            height: auto
        }

        input[type="search"] {
            -webkit-appearance: textfield;
            -moz-box-sizing: content-box;
            -webkit-box-sizing: content-box;
            box-sizing: content-box
        }

        input[type="search"]::-webkit-search-cancel-button,
        input[type="search"]::-webkit-search-decoration {
            -webkit-appearance: none
        }

        @font-face {
            font-family: 'museo-sans-rounded';
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-300-webfont.eot');
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-300-webfont.eot?#iefix') format('embedded-opentype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-300-webfont.woff') format('woff'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-300-webfont.ttf') format('truetype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-300-webfont.svg#museo_sans_rounded300') format('svg');
            font-weight: 300;
            font-style: normal
        }

        @font-face {
            font-family: 'museo-sans-rounded';
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-500-webfont.eot');
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-500-webfont.eot?#iefix') format('embedded-opentype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-500-webfont.woff') format('woff'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-500-webfont.ttf') format('truetype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-500-webfont.svg#museo_sans_rounded500') format('svg');
            font-weight: 500;
            font-style: normal
        }

        @font-face {
            font-family: 'museo-sans-rounded';
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-700-webfont.eot');
            src: url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-700-webfont.eot?#iefix') format('embedded-opentype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-700-webfont.woff') format('woff'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-700-webfont.ttf') format('truetype'), url('//d7mj4aqfscim2.cloudfront.net/proxy/fonts/museo/museosansrounded-700-webfont.svg#museo_sans_rounded700') format('svg');
            font-weight: 700;
            font-style: normal
        }
        /*
        * {
            outline: none
        }*/

        body {
            font-size: 17px;
            font-weight: 300;
            line-height: 26px;
            text-transform: none;
            background: #f0f0f0;
            color: #6f6f6f;
            font-family: "museo-sans-rounded", sans-serif;
            -webkit-font-smoothing: antialiased;
            overflow-y: scroll
        }

        button {
            font-size: 15px;
            font-weight: 700;
            text-transform: uppercase;
            border: 0;
            border-radius: 999px;
            color: white;
            height: 45px;
            outline: none;
            padding: 0 20px
        }

        button:hover {
            opacity: .9
        }

        .btn-primary {
            background: #1cb0f6
        }

        .btn-primary:disabled {
            background: #888;
            opacity: .5
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid #6f6f6f;
            box-sizing: border-box;
            color: #6f6f6f
        }

        .btn-secondary:hover {
            color: #4c4c4c;
            opacity: 1
        }

        .btn-secondary:disabled {
            color: #888;
            opacity: .5
        }

        .btn-facebook {
            background: #39559f
        }

        .btn-facebook:before {
            background: url("/design/img/facebook-icon.svg");
            content: '';
            float: left;
            height: 20px;
            margin-top: 2px;
            width: 10px
        }

        .btn-google {
            background: #df360a
        }

        .btn-google:before {
            background: url("/design/img/google-icon.svg");
            content: '';
            float: left;
            height: 21px;
            margin-top: 3px;
            width: 21px
        }

        .radio-label,
        .checkbox-label {
            cursor: pointer;
            display: inline-block;
            font-size: 17px
        }

        .radio-label.bordered,
        .checkbox-label.bordered {
            border-radius: 999px;
            border: 2px solid #6f6f6f;
            box-sizing: border-box;
            color: #6f6f6f;
            font-size: 17px;
            min-width: 220px;
            padding: 8px 15px
        }

        .radio-label.bordered.checked,
        .checkbox-label.bordered.checked {
            background: #1cb0f6;
            border-color: #1cb0f6;
            color: white
        }

        input[type=text] {
            border: 2px solid #cfcfcf;
            border-radius: 6px;
            color: #4c4c4c;
            font-size: 17px;
            font-weight: 500;
            padding: 10px 15px
        }

        input[type=text]:focus {
            border-color: #1cb0f6
        }

        input[type=radio] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 2px solid #6f6f6f;
            border-radius: 999px;
            height: 1em;
            margin-right: 5px;
            position: relative;
            top: 2px;
            width: 1em
        }

        input[type=radio]:checked {
            border-color: #1cb0f6
        }

        input[type=radio]:checked:after {
            background: #1cb0f6;
            border-radius: 999px;
            content: '';
            height: 55%;
            left: 3px;
            position: absolute;
            top: 3px;
            width: 55%
        }

        .radio-label.bordered input:checked {
            background: #1cb0f6;
            border-color: white
        }

        .radio-label.bordered input:checked:after {
            background: white
        }

        input[type=checkbox] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            border: 2px solid #6f6f6f;
            height: 1em;
            margin-right: 5px;
            position: relative;
            top: 2px;
            width: 1em
        }

        input[type=checkbox]:checked {
            border-color: #1cb0f6
        }

        input[type=checkbox]:checked:after {
            -webkit-transform: rotate(-45deg);
            border-bottom: 3px solid #1cb0f6;
            border-left: 3px solid #1cb0f6;
            content: '';
            height: 35%;
            left: 13%;
            position: absolute;
            top: 13%;
            width: 55%
        }
    </style>

    <!-- nps.css -->
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(255, 255, 255, 0);
            -webkit-tap-highlight-color: transparent;
        }

        input:focus,
        select:focus,
        textarea:focus,
        button:focus {
            outline: none;
        }

        .nps-bubble {
            font-size: 17px;
            width: 42px;
            height: 42px;
            border: 2px solid;
            border-radius: 20px;
            text-align: center;
            line-height: 39px;
            font-weight: 700;
            cursor: pointer;
        }

        .nps-title {
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            color: #4C4C4C;
            padding: 21px;
            text-align: center;
        }

        .nps-dd-first-row {
            display: -webkit-box;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .nps-dd-first-row .nps-bubble {
            color: red;
            margin-right: 7px;
        }

        .nps-dd-first-row :last-child {
            margin-right: 0 !important;
        }

        .nps-dd-second-row {
            margin: 10px 0 0 16px;
            display: -webkit-box;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
        }

        .nps-dd-second-row .nps-bubble {
            color: red;
            margin-left: 7px;
        }

        .nps-dd-second-row :last-child {
            margin-right: 0 !important;
        }

        .npscontrols-wrapper {
            margin: 0 auto 16px;
        }

        .npscontrols-btn {
            width: 160px;
            margin: 0 4px;
        }

        .doubledecknps-wrapper {
            position: absolute;
            top: 50%;
            left: 50%;
        }

        .doubledecknps-meter {
            position: relative;
            margin-top: -50%;
            left: -50%;
        }

        .doubledecknps-meter-inner {
            display: table;
            margin: 0 auto;
        }

        .doubledecknps-tag {
            font-weight: 700;
            font-size: 15px;
            text-align: center;
            margin: 30px 0;
        }

        .doubledecknps-controls {
            position: absolute;
            text-align: center;
            width: 100%;
            bottom: 0;
        }
    </style>
    <!-- Viewport Meta Tag -->
    <meta name="viewport" content="width=device-width, user-scalable=no" />
</head>
<body>
    <!-- Placed at the end of the document so pages load faster -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mithril/0.2.3/mithril.js"></script>

    <!-- App -->
    <script>
        'use strict';

        /** Main app */
        var app = {};

        /** Helpers */
        app.helpers = {};

        /**
         * Returns a list of NPS score items.
         * If reverse is true, returns items in reverse order.
         */
        app.helpers.get_chronology = function () {
            var chronology = {
                standard: _.range(11),
                reversed: _.range(10, -1, -1)
            };

            return function (type) {
                return chronology[type] || chronology.standard;
            };
        }();

        app.helpers.nps = {};

        /** Returns a color for a given item and scheme, e.g. get_score_color(0, 'neutral') === '#FF5512' */
        app.helpers.nps.get_score_color = function () {
            var color_schemes = {
                neutral: {
                    0: '#FF5512',
                    1: '#E65C13',
                    2: '#E65C13',
                    3: '#BF846F',
                    4: '#9F7B74',
                    5: '#868389',
                    6: '#6D8A9F',
                    7: '#518FB4',
                    8: '#419FCF',
                    9: '#10A1E4',
                    10: '#08ABFF'
                },
                nps: {
                    0: '#E53838',
                    1: '#E53838',
                    2: '#E53838',
                    3: '#E53838',
                    4: '#E53838',
                    5: '#E53838',
                    6: '#E53838',
                    7: '#FAA918',
                    8: '#FAA918',
                    9: '#7AC70C',
                    10: '#7AC70C'
                },
                neutral_reverse: {
                    0: '#08ABFF',
                    1: '#10A1E4',
                    2: '#419FCF',
                    3: '#518FB4',
                    4: '#6D8A9F',
                    5: '#868389',
                    6: '#9F7B74',
                    7: '#BF846F',
                    8: '#E65C13',
                    9: '#E65C13',
                    10: '#FF5512'
                }
            };

            return function (item, scheme) {
                var color_scheme = color_schemes[scheme] || color_schemes.neutral;
                return color_scheme[item];
            };
        }();

        /** Models */
        app.models = {};

        /** Constants */
        app.constants = {};

        app.constants.l10n = {
            less_likely: 'less likely',
            more_likely: 'more likely',
            how_likely: 'How likely are you to recommend Duolingo to a friend?'
        };

        /** Reusable components */
        app.components = {};

        app.components.NPSControls = {};

        app.components.NPSControls.controller = function (args) {
            this.click_skip = args.click_skip;
            this.click_submit = args.click_submit;
            this.ready = args.ready;
        };

        app.components.NPSControls.view = function (ctrl, args) {
            var ready = ctrl.ready();
            return m('div.npscontrols-wrapper', [m('button.btn-secondary.npscontrols-btn', {
                onclick: ctrl.click_skip
            }, 'skip'), m('button.btn-primary.npscontrols-btn', {
                onclick: ctrl.click_submit,
                disabled: !ready
            }, 'submit')]);
        };

        /** Displays the NPS numerals bubbles, i.e. 0, 1, ..., 10, in two horizontal rows. */
        app.components.DoubleDeckNPSMeter = {};

        app.components.DoubleDeckNPSMeter.controller = function (args) {};

        app.components.DoubleDeckNPSMeter.view = function (ctrl, args) {
            var items = app.helpers.get_chronology(args.variant_data.chronology);

            var bubble_factory = function bubble_factory(score) {
                var is_selected = args.selected_score() === score;
                var color = app.helpers.nps.get_score_color(score, args.variant_data.color_scheme);
                return m('div.nps-bubble', {
                    onclick: _.bind(args.selected_score, _, score),
                    style: {
                        color: is_selected ? '#FFFFFF' : color,
                        borderColor: color,
                        backgroundColor: is_selected ? color : ''
                    }
                }, score);
            };

            var first_row = m('div.nps-dd-first-row', [_.map(items.slice(0, 6), bubble_factory)]);

            var second_row = m('div.nps-dd-second-row', [_.map(items.slice(6), bubble_factory)]);

            return m('div', [first_row, second_row]);
        };

        app.components.DoubleDeckNPS = {};

        app.components.DoubleDeckNPS.controller = function (args) {
            var _this = this;

            this.title = m.prop(args.title);
            this.selected_score = m.prop();

            this.ready = function () {
                return _this.selected_score() !== undefined;
            };
            this.click_skip = args.click_skip;
            this.click_submit = args.click_submit;
        };

        app.components.DoubleDeckNPS.view = function (ctrl, args) {
            console.log('ctrl.selected_score()', ctrl.selected_score());
            var l10n = app.constants.l10n;

            return m('div', [m('div.nps-title', ctrl.title()), m('div.doubledecknps-wrapper', [m('div.doubledecknps-meter', [m('div.doubledecknps-tag', l10n.less_likely.toUpperCase()), m('div.doubledecknps-meter-inner', [m.component(app.components.DoubleDeckNPSMeter, {
                selected_score: ctrl.selected_score,
                variant_data: args.variant_data
            })]), m('div.doubledecknps-tag', l10n.more_likely.toUpperCase())])]), m('div.doubledecknps-controls', m.component(app.components.NPSControls, {
                click_skip: ctrl.click_skip,
                click_submit: ctrl.click_submit,
                ready: ctrl.ready
            }))]);
        };

        /** Main app view */
        app.components.virtualizer = {};

        app.components.virtualizer.controller = function (args) {
            this.click_skip = function () {
                if (Android) {
                    Android.finish();
                } else {
                    console.log('Android not found');
                }
            };

            this.click_submit = function () {
                if (Android) {
                    Android.showToast("Clicked submit!");
                } else {
                    console.log('Android not found');
                }
            };
        };

        app.components.virtualizer.view = function (ctrl, args) {
            var l10n = app.constants.l10n;


            return m.component(app.components.DoubleDeckNPS, {
                title: l10n.how_likely,
                variant_data: {
                    chronology: 'standard',
                    color_scheme: 'neutral'
                },
                click_skip: ctrl.click_skip,
                click_submit: ctrl.click_submit
            });
        };

        app.controller = function (args) {};

        app.view = function (ctrl, args) {
            return m.component(app.components.virtualizer, {});
        };

        /** Main app */
        (function () {

            m.mount(document.body, { controller: app.controller, view: app.view });
            return;
        })();
    </script>
</body>
</html>